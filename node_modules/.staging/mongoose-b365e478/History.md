5.13.4 / 2021-07-28
===================
 * fix: avoid pulling non-schema paths from documents into nested paths #10449
 * fix(update): support overwriting nested map paths #10485
 * fix(update): apply timestamps to subdocs that would be newly created by `$setOnInsert` #10460
 * fix(map): correctly clone subdocs when calling toObject() on a map #10486
 * fix(cursor): cap parallel batchSize for populate at 5000 #10449
 * fix(index.d.ts): improve autocomplete for new Model() by making `doc` an object with correct keys #10475
 * fix(index.d.ts): add MongooseOptions interface #10471 [thiagokisaki](https://github.com/thiagokisaki)
 * fix(index.d.ts): make LeanDocument work with PopulatedDoc #10494
 * docs(mongoose+connection): correct default value for bufferTimeoutMS #10476
 * chore: remove unnecessary 'eslint-disable' comments #10466 [thiagokisaki](https://github.com/thiagokisaki)

5.13.3 / 2021-07-16
===================
 * fix(model): avoid throwing error when bulkSave() called on a document with no changes #10437
 * fix(timestamps): apply timestamps when creating new subdocs with `$addToSet` and with positional operator #10447
 * fix(schema): allow calling Schema#loadClass() with class that has a static getter with no setter #10436
 * fix(model): handle re-applying object defaults after explicitly unsetting #10442 [semirturgay](https://github.com/semirturgay)
 * fix: bump mongodb driver -> 3.6.10 #10440 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(index.d.ts): consistently use NativeDate instead of Date for Date validators and timestamps functions #10426
 * fix(index.d.ts): allow calling `discriminator()` with non-document #10452 #10421 [DouglasGabr](https://github.com/DouglasGabr)
 * fix(index.d.ts): allow passing ResultType generic to Schema#path() #10435

5.13.2 / 2021-07-03
===================
 * fix: hardcode @types/node version for now to avoid breaking changes from DefinitelyTyped/DefinitelyTyped#53669 #10415
 * fix(index.d.ts): allow using type: Date with Date paths in SchemaDefinitionType #10409
 * fix(index.d.ts): allow extra VirtualTypeOptions for better plugin support #10412
 * docs(api): add SchemaArray to docs #10397
 * docs(schema+validation): fix broken links #10396
 * docs(transactions): add note about creating a connection to transactions docs #10406

5.13.1 / 2021-07-02
===================
 * fix(discriminator): allow using array as discriminator key in schema and as tied value #10303
 * fix(index.d.ts): allow using & Document in schema definition for required subdocument arrays #10370
 * fix(index.d.ts): if using DocType that doesn't extends Document, default to returning that DocType from `toObject()` and `toJSON()` #10345
 * fix(index.d.ts): use raw DocType instead of LeanDocument when using `lean()` with queries if raw DocType doesn't `extends Document` #10345
 * fix(index.d.ts): remove err: any in callbacks, use `err: CallbackError` instead #10340
 * fix(index.d.ts): allow defining map of schemas in TypeScript #10389
 * fix(index.d.ts): correct return type for Model.createCollection() #10359
 * docs(promises+discriminators): correctly escape () in regexp to pull in examples correctly #10364
 * docs(update): fix outdated URL about unindexed upsert #10406 [grimmer0125](https://github.com/grimmer0125)
 * docs(index.d.ts): proper placement of mongoose.Date JSDoc [thiagokisaki](https://github.com/thiagokisaki)

5.13.0 / 2021-06-28
===================
 * feat(query): add sanitizeProjection option to opt in to automatically sanitizing untrusted query projections #10243
 * feat(model): add `bulkSave()` function that saves multiple docs in 1 `bulkWrite()` #9727 #9673 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * feat(document): allow passing a list of virtuals or `pathsToSkip` to apply in `toObject()` and `toJSON()` #10120
 * fix(model): make Model.validate use object under validation as context by default #10360 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * feat(document): add support for pathsToSkip in validate and validateSync #10375 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * feat(model): add `diffIndexes()` function that calculates what indexes `syncIndexes()` will create/drop without actually executing any changes #10362 [IslandRhythms](https://github.com/IslandRhythms)
 * feat(document): avoid using sessions that have ended, so you can use documents that were loaded in the session after calling `endSession()` #10306

5.12.15 / 2021-06-25
====================
 * fix(index.d.ts): add extra TInstanceMethods generic param to `Schema` for cases when we can't infer from Model #10358
 * fix(index.d.ts): added typings for near() in model aggregation #10373 [tbhaxor](https://github.com/tbhaxor)
 * fix(index.d.ts): correct function signature for `Query#cast()` #10388 [lkho](https://github.com/lkho)
 * docs(transactions): add import statement #10365 [JimLynchCodes](https://github.com/JimLynchCodes)
 * docs(schema): add missing `discriminatorKey` schema option #10386 #10376 [IslandRhythms](https://github.com/IslandRhythms)
 * docs(index.d.ts): fix typo #10363 [houssemchebeb](https://github.com/houssemchebeb)

5.12.14 / 2021-06-15
====================
 * fix(schema): check that schema type is an object when setting isUnderneathDocArray #10361 [vmo-khanus](https://github.com/vmo-khanus)
 * fix(document): avoid infinite recursion when setting single nested subdoc to array #10351
 * fix(populate): allow populating nested path in schema using `Model.populate()` #10335
 * fix(drivers): emit operation-start/operation-end events to allow inspecting when operations start and end
 * fix(index.d.ts): improve typings for virtuals #10350 [thiagokisaki](https://github.com/thiagokisaki)
 * fix(index.d.ts): correct constructor type for Document #10328
 * fix(index.d.ts): add `ValidationError` as a possible type for `ValidationError#errors` #10320 [IslandRhythms](https://github.com/IslandRhythms)
 * fix: remove unnecessary async devDependency that's causing npm audit warnings #10281
 * docs(typescript): add schemas guide #10308
 * docs(model): add options parameter description to `Model.exists()` #10336 [Aminoiz](https://github.com/Aminoiz)

5.12.13 / 2021-06-04
====================
 * perf(document): avoid creating nested paths when running `$getAllSubdocs()` #10275
 * fix: make returnDocument option work with `findOneAndUpdate()` #10232 #10231 [cnwangjie](https://github.com/cnwangjie)
 * fix(document): correctly reset subdocument when resetting a map subdocument underneath a single nested subdoc after save #10295
 * perf(query): avoid setting non-null sessions to avoid overhead from $getAllSubdocs() #10275
 * perf(document): pre split schematype paths when compiling schema to avoid extra overhead of splitting when hydrating documents #10275
 * perf(schema): pre-calculate mapPaths to avoid looping over every path for each path when initing doc #10275
 * fix(index.d.ts): drill down into nested arrays when creating LeanDocument type #10293

5.12.12 / 2021-05-28
====================
 * fix(documentarray): retain atomics when setting to a new array #10272
 * fix(query+model): fix deprecation warning for `returnOriginal` with `findOneAndUpdate()` #10298 #10297 #10292 #10285 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(index.d.ts): make `map()` result an array if used over an array #10288 [quantumsheep](https://github.com/quantumsheep)

5.12.11 / 2021-05-24
====================
 * fix(populate): skip applying setters when casting arrays for populate() to avoid issues with arrays of immutable elements #10264
 * perf(schematype): avoid cloning setters every time we run setters #9588
 * perf(get): add benchmarks and extra cases to speed up get() #9588
 * perf(array): improve array constructor performance on small arrays to improve nested array perf #9588
 * fix(index.d.ts): allow using type: [String] with string[] when using SchemaDefinition with generic #10261
 * fix(index.d.ts): support ReadonlyArray as well as regular array where possible in schema definitions #10260
 * docs(connection): document noListener option to useDb #10278 [stuartpb](https://github.com/stuartpb)
 * docs: migrate raw tutorial content from pug / JS to markdown #10271
 * docs: fix typo #10269 [sanjib](https://github.com/sanjib)

5.12.10 / 2021-05-18
====================
 * fix(query): allow setting `defaults` option on result documents from query options #7287 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(populate): handle populating embedded discriminator with custom tiedValue #10231
 * fix(document): allow passing space-delimited string of `pathsToValidate` to `validate()` and `validateSync()` #10258
 * fix(model+schema): support `loadClass()` on classes that have `collection` as a static property #10257 #10254 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(SchemaArrayOptions): correct property name #10236
 * fix(index.d.ts): add any to all query operators to minimize likelihood of "type instantiation is excessively deep" when querying docs with 4-level deep subdocs #10189
 * fix(index.d.ts): add $parent() in addition to parent() in TS definitions
 * fix(index.d.ts): correct async iterator return type for QueryCursor #10253 #10252 #10251 [borfig](https://github.com/borfig)
 * fix(index.d.ts): add `virtualsOnly` parameter to `loadClass()` function signature [IslandRhythms](https://github.com/IslandRhythms)
 * docs(typescript): add typescript populate docs #10212
 * docs: switch from AWS to Azure Functions for search #10244

5.12.9 / 2021-05-13
===================
 * fix(schema): ensure add() overwrites existing schema paths by default #10208 #10203
 * fix(schema): support creating nested paths underneath document arrays #10193
 * fix(update): convert nested dotted paths in update to nested paths to avoid ending up with dotted properties in update #10200
 * fix(document): allow calling validate() and validateSync() with `options` as first parameter #10216
 * fix(schema): apply static properties to model when using loadClass() #10206
 * fix(index.d.ts): allow returning Promise<void> from middleware functions #10229
 * fix(index.d.ts): add pre('distinct') hooks to TypeScript #10192

5.12.8 / 2021-05-10
===================
 * fix(populate): handle populating immutable array paths #10159
 * fix(CastError): add `toJSON()` function to ensure `name` property always ends up in `JSON.stringify()` output #10166 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(query): add allowDiskUse() method to improve setting MongoDB 4.4's new `allowDiskUse` option #10177
 * fix(populate): allow populating paths under mixed schematypes where some documents have non-object properties #10191
 * chore: remove unnecessary driver dynamic imports so Mongoose can work with Parcel #9603
 * fix(index.d.ts): allow any object as parameter to create() and `insertMany()` #10144
 * fix(index.d.ts): allow creating Model class with raw interface, no `extends Document` #10144
 * fix(index.d.ts): separate UpdateQuery from `UpdateWithAggregationPipeline` for cases when `UpdateQuery` is used as a function param #10186
 * fix(index.d.ts): don't require error value in pre/post hooks #10213 [michaln-q](https://github.com/michaln-q)
 * docs(typescript): add a typescript intro tutorial and statics tutorial #10021
 * docs(typescript): add query helpers tutorial #10021
 * docs(deprecations): add note that you can safely ignore `useFindAndModify` and `useCreateIndex` deprecation warnings #10155
 * chore(workflows): add node 16 to github actions #10201 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)

5.12.7 / 2021-04-29
===================
 * fix(document): make $getPopulatedDocs() return populated virtuals #10148
 * fix(discriminator): take discriminator schema's single nested paths over base schema's #10157
 * fix(discriminator): allow numbers and ObjectIds as tied values for discriminators #10130
 * fix(document): avoid double validating paths underneath mixed objects in save() #10141
 * fix(schema): allow path() to return single nested paths within document arrays #10164
 * fix(model+query): consistently wrap query callbacks in `process.nextTick()` to avoid clean stack traces causing memory leak when using synchronous recursion like `async.whilst()` #9864
 * fix(cursor): correctly report CastError when using noCursorTimeout flag #10150
 * fix(index.d.ts): add CastError constructor #10176
 * fix(index.d.ts): allow setting mongoose.pluralize(null) in TypeScript #10185
 * docs: add link to transactions guide from nav bar #10143
 * docs(validation): add section about custom error messages #10140
 * docs: make headers linkable via clicking #10156
 * docs: broken link in document.js #10190 [joostdecock](https://github.com/joostdecock)
 * docs: make navbar responsive on legacy 2.x docs #10171 [ad99526](https://github.com/ad99526)

5.12.6 / 2021-04-27
===================
 * fix(query): allow setting `writeConcern` schema option to work around MongoDB driver's `writeConcern` deprecation warning #10083 #10009 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(populate): dedupe when virtual populate foreignField is an array to avoid duplicate docs in result #10117
 * fix(populate): add `localField` filter to `$elemMatch` on virtual populate when custom `match` has a `$elemMatch` and `foreignField` is an array #10117
 * fix(query): convert projection string values to numbers as a workaround for #10142
 * fix(document): set version key filter on `save()` when using `optimisticConcurrency` if no changes in document #10128 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(model): use `obj` as `context` in `Model.validate()` if `obj` is a document #10132
 * fix(connection): avoid db events deprecation warning when using `useDb()` with `useUnifiedTopology` #8267
 * fix: upgrade to sift@13.5.2 to work around transitive dev dependency security warning #10121
 * fix(index.d.ts): allow any object as parameter to `create()` and `insertMany()` #10144
 * fix(index.d.ts): clarify that `eachAsync()` callback receives a single doc rather than array of docs unless `batchSize` is set #10135
 * fix(index.d.ts): clarify that return value from `validateSync()` is a ValidationError #10147 [michaln-q](https://github.com/michaln-q)
 * fix(index.d.ts): add generic type for Model constructor #10074 [Duchynko](https://github.com/Duchynko)
 * fix(index.d.ts): add parameter type in merge #10168 [yoonhoGo](https://github.com/yoonhoGo)

5.12.5 / 2021-04-19
===================
 * fix(populate): handle populating underneath document array when document array property doesn't exist in db #10003
 * fix(populate): clear out dangling pointers to populated docs so query cursor with populate() can garbage collect populated subdocs #9864
 * fix(connection): pull correct `autoCreate` value from Mongoose global when creating new model before calling `connect()` #10091
 * fix(populate): handle populating paths on documents with discriminator keys that point to non-existent discriminators #10082
 * fix(index.d.ts): allow numbers as discriminator names #10115
 * fix(index.d.ts): allow `type: Boolean` in Schema definitions #10085
 * fix(index.d.ts): allow passing array of aggregation pipeline stages to `updateOne()` and `updateMany()` #10095
 * fix(index.d.ts): support legacy 2nd param callback syntax for `deleteOne()`, `deleteMany()` #10122
 * docs(mongoose): make `useCreateIndex` always `false` in docs #10033
 * docs(schema): fix incorrect links from schema API docs #10111

5.12.4 / 2021-04-15
===================
 * fix: upgrade mongodb driver -> 3.6.6 #10079
 * fix: store fields set with select:false at schema-level when saving a new document #10101 [ptantiku](https://github.com/ptantiku)
 * fix(populate): avoid turning already populated field to null when populating an existing lean document #10068 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(populate): correctly populate lean subdocs with `_id` property #10069
 * fix(model): insertedDocs may contain docs that weren't inserted #10098 [olnazx](https://github.com/olnazx)
 * fix(schemaType): make type Mixed cast error objects to pojos #10131 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(populate): support populating embedded discriminators in nested arrays #9984
 * fix(populate): handle populating map paths using trailing `.$*` #10123
 * fix(populate): allow returning primitive from `transform()` function for single conventional populate #10064
 * fix(index.d.ts): allow generic classes of `T` to use `T & Document` internally #10046
 * fix(index.d.ts): allow `$pull` with `$` paths #10075
 * fix(index.d.ts): use correct `Date` type for `$currentDate` #10058
 * fix(index.d.ts): add missing asyncInterator to Query type def #10094 [borfig](https://github.com/borfig)
 * fix(index.d.ts): allow RHS of `$unset` properties to be any value #10066
 * fix(index.d.ts): allow setting SchemaType `index` property to a string #10077
 * refactor(index.d.ts): move discriminator() to common interface #10109 [LoneRifle](https://github.com/LoneRifle)

5.12.3 / 2021-03-31
===================
 * fix: avoid setting schema-level collation on text indexes #10044 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(query): add `writeConcern()` method to avoid writeConcern deprecation warning #10009
 * fix(connection): use queueing instead of event emitter for `createCollection()` and other helpers to avoid event emitter warning #9778
 * fix(connection): scope `Connection#id` to Mongoose instance so id always lines up with `mongoose.connections` index #10025 [IslandRhythms](https://github.com/IslandRhythms)
 * fix: avoid throwing in `promiseOrCallback()` if 3rd param isn't an EventEmitter #10055 [emrebass](https://github.com/emrebass)
 * fix(index.d.ts): add Model as 2nd generic param to `Model.discriminator()` #10054 [coro101](https://github.com/coro101)
 * fix(index.d.ts): add docs to `next()` callback for `pre('insertMany')` hooks #10078 #10072 [pezzu](https://github.com/pezzu)
 * fix(index.d.ts): add `transform` to PopulateOptions interface #10061
 * fix(index.d.ts): add DocumentQuery type for backwards compatibility #10036

5.12.2 / 2021-03-22
===================
 * fix(QueryCursor): consistently execute `post('find')` hooks with an array of docs #10015 #9982 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(schema): support setting `ref` as an option on an array SchemaType #10029
 * fix(query): apply schema-level `select` option from array schematypes #10029
 * fix(schema): avoid possible prototype pollution with `Schema()` constructor #10035 [zpbrent](https://github.com/zpbrent)
 * fix(model): make bulkWrite skip timestamps with timestamps: false #10050 [SoftwareSing](https://github.com/SoftwareSing)
 * fix(index.d.ts): make query methods return `QueryWithHelpers` so query helpers pass through chaining #10040
 * fix(index.d.ts): add `upserted` array to `updateOne()`, `updateMany()`, `update()` result #10042
 * fix(index.d.ts): add back `Aggregate#project()` types that were mistakenly removed in 5.12.0 #10043
 * fix(index.d.ts): always allow setting `type` in Schema to a SchemaType class or a Schema instance #10030
 * docs(transactions): introduce `session.withTransaction()` before `session.startTransaction()` because `withTransaction()` is the recommended approach #10008
 * docs(mongoose+browser): fix broken links to info about `mongoose.Types` #10016

5.12.1 / 2021-03-18
===================
 * fix: update mongodb -> 3.6.5 to fix circular dependency warning #9900
 * fix(document): make `toObject()` use child schema `flattenMaps` option by default #9995
 * fix(ObjectId): make `isValidObjectId()` check that length 24 strings are hex chars only #10010 #9996 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(query): correctly cast embedded discriminator paths when discriminator key is specified in array filter #9977
 * fix(schema): skip `populated()` check when calling `applyGetters()` with a POJO for mongoose-lean-getters support #9986
 * fix(populate): support populating dotted subpath of a populated doc that has the same id as a populated doc #10005
 * fix(index.d.ts): correct `this` for query helpers #10028 [francescov1](https://github.com/francescov1)
 * fix(index.d.ts): avoid omitting function property keys in LeanDocuments, because TS can't accurately infer what's a function if using generic functions #9989
 * fix(index.d.ts): correct type definition for `SchemaType#cast()` #10039 #9980
 * fix(index.d.ts): make SchemaTypeOptions a class, add missing `SchemaType#OptionsConstructor` #10001
 * fix(index.d.ts): support calling `findByIdAndUpdate()` with filter, update, callback params #9981

5.12.0 / 2021-03-11
===================
 * feat(populate): add `transform` option that Mongoose will call on every populated doc #3775
 * feat(query): make `Query#pre()` and `Query#post()` public #9784
 * feat(document): add `Document#getPopulatedDocs()` to return an array of all populated documents in a document #9702 [IslandRhythms](https://github.com/IslandRhythms)
 * feat(document): add `Document#getAllSubdocs()` to return an array of all single nested and array subdocuments #9764 [IslandRhythms](https://github.com/IslandRhythms)
 * feat(schema): allow `schema` as a schema path name #8798 [IslandRhythms](https://github.com/IslandRhythms)
 * feat(QueryCursor): Add batch processing for eachAsync #9902 [khaledosama999](https://github.com/khaledosama999)
 * feat(connection): add `noListener` option to help with use cases where you're using `useDb()` on every request #9961
 * feat(index): emit 'createConnection' event when user calls `mongoose.createConnection()` #9985
 * feat(connection+index): emit 'model' and 'deleteModel' events on connections when creating and deleting models #9983
 * feat(query): allow passing `explain` option to `Model.exists()` #8098 [IslandRhythms](https://github.com/IslandRhythms)

5.11.20 / 2021-03-11
====================
 * fix(query+populate): avoid unnecessarily projecting in subpath when populating a path that uses an elemMatch projection #9973
 * fix(connection): avoid `db` events deprecation warning with 'close' events #10004 #9930
 * fix(index.d.ts): make `$pull` more permissive to allow dotted paths #9993

5.11.19 / 2021-03-05
====================
 * fix(document): skip validating array elements that aren't modified when `validateModifiedOnly` is set #9963
 * fix(timestamps): apply timestamps on `findOneAndReplace()` #9951
 * fix(schema): correctly handle trailing array filters when looking up schema paths #9977
 * fix(schema): load child class getter for virtuals instead of base class when using `loadClass()` #9975
 * fix(index.d.ts): allow creating statics without passing generics to `Schema` constructor #9969
 * fix(index.d.ts): add QueryHelpers generic to schema and model, make all query methods instead return QueryWithHelpers #9850
 * fix(index.d.ts): support setting `type` to an array of schemas when using SchemaDefinitionType #9962
 * fix(index.d.ts): add generic to plugin schema definition #9968 [emiljanitzek](https://github.com/emiljanitzek)
 * docs: small typo fix #9964 [KrishnaMoorthy12](https://github.com/KrishnaMoorthy12)

5.11.18 / 2021-02-23
====================
 * fix(connection): set connection state to `disconnected` if connecting string failed to parse #9921
 * fix(connection): remove `db` events deprecation warning if `useUnifiedTopology = true` #9930
 * fix(connection): fix promise chaining for openUri #9960 [lantw44](https://github.com/lantw44)
 * fix(index.d.ts): add `PopulatedDoc` type to make it easier to define populated docs in interfaces #9818
 * fix(index.d.ts): allow explicitly overwriting `toObject()` return type for backwards compatibility #9944
 * fix(index.d.ts): correctly throw error when interface path type doesn't line up with schema path type #9958 [ShadiestGoat](https://github.com/ShadiestGoat)
 * fix(index.d.ts): remove `any` from `deleteX()` and `updateX()` query params and return values #9959 [btd](https://github.com/btd)
 * fix(index.d.ts): add non-generic versions of `Model.create()` for better autocomplete #9928
 * docs: correctly handle multiple `&gt` in API descriptions #9940

5.11.17 / 2021-02-17
====================
 * fix(populate): handle `perDocumentLimit` when multiple documents reference the same populated doc #9906
 * fix(document): handle directly setting embedded document array element with projection #9909
 * fix(map): cast ObjectId to string inside of MongooseMap #9938 [HunterKohler](https://github.com/HunterKohler)
 * fix(model): use schema-level default collation for indexes if index doesn't have collation #9912
 * fix(index.d.ts): make `SchemaTypeOptions#type` optional again to allow alternative typeKeys #9927
 * fix(index.d.ts): support `{ type: String }` in schema definition when using SchemaDefinitionType generic #9911
 * docs(populate+schematypes): document the `$*` syntax for populating every entry in a map #9907
 * docs(connection): clarify that `Connection#transaction()` promise resolves to a command result #9919

5.11.16 / 2021-02-12
====================
 * fix(document): skip applying array element setters when init-ing an array #9889
 * fix: upgrade to mongodb driver 3.6.4 #9893 [jooeycheng](https://github.com/jooeycheng)
 * fix: avoid copying Object.prototype properties when cloning #9876
 * fix(aggregate): automatically convert functions to strings when using `$function` operator #9897
 * fix: call pre-remove hooks for subdocuments #9895 #9885 [IslandRhythms](https://github.com/IslandRhythms)
 * docs: fix confusing sentence in Schema docs #9914 [namenyi](https://github.com/namenyi)

5.11.15 / 2021-02-03
====================
 * fix(document): fix issues with `isSelected` as an path in a nested schema #9884 #9873 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(index.d.ts): better support for `SchemaDefinition` generics when creating schema #9863 #9862 #9789
 * fix(index.d.ts): allow required function in array definition #9888 [Ugzuzg](https://github.com/Ugzuzg)
 * fix(index.d.ts): reorder create typings to allow array desctructuring #9890 [Ugzuzg](https://github.com/Ugzuzg)
 * fix(index.d.ts): add missing overload to Model.validate #9878 #9877 [jonamat](https://github.com/jonamat)
 * fix(index.d.ts): throw compiler error if schema says path is a String, but interface says path is a number #9857
 * fix(index.d.ts): make `Query` a class, allow calling `Query#where()` with object argument and with no arguments #9856
 * fix(index.d.ts): support calling `Schema#pre()` and `Schema#post()` with options and array of hooked function names #9844
 * docs(faq): mention other debug options than console #9887 [dandv](https://github.com/dandv)
 * docs(connections): clarify that Mongoose can emit 'error' both during initial connection and after initial connection #9853

5.11.14 / 2021-01-28
====================
 * fix(populate): avoid inferring `justOne` from parent when populating a POJO with a manually populated path #9833 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(document): apply setters on each element of the array when setting a populated array #9838
 * fix(map): handle change tracking on maps of subdocs #9811 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(document): remove dependency on `documentIsSelected` symbol #9841 [IslandRhythms](https://github.com/IslandRhythms)
 * fix(error): make ValidationError.toJSON to include the error name correctly #9849 [hanzki](https://github.com/hanzki)
 * fix(index.d.ts): indicate that `Document#remove()` returns a promise, not a query #9826
 * fix(index.d.ts): allow setting `SchemaType#enum` to TypeScript enum with `required: true` #9546

5.11.13 / 2021-01-20
====================
 * fix(map): handle change tracking on map of arrays #9813
 * fix(connection): allow passing options to `Connection#transaction()` #9834 [pnutmath](https://github.com/pnutmath)
 * fix(index.d.ts): make `Query#options#rawResult` take precedence over `new`+`upsert` #9816
 * fix(index.d.ts): changed setOptions's 'overwrite' argument to optional #9824 [pierissimo](https://github.com/pierissimo)
 * fix(index.d.ts): allow setting `mongoose.Promise` #9820
 * fix(index.d.ts): add `Aggregate#replaceRoot()` #9814
 * fix(index.d.ts): make `Model.create()` with a spread return a promise of array rather than single doc #9817
 * fix(index.d.ts): use SchemaDefinitionProperty generic for SchemaTypeOptions if specified #9815
 * docs(populate): add note about setting `toObject` for populate virtuals #9822

5.11.12 / 2021-01-14
====================
 * fix(document): handle using `db` as a document path #9798
 * fix(collection): make sure to call `onOpen()` if `autoCreate === false` #9807
 * fix(index.d.ts): correct query type for `findOneAndUpdate()` and `findByIdAndUpdate()` with `rawResult = true` #9803
 * fix(index.d.ts): require setting `new: true` or `returnOriginal: false` to skip null check with `findOneAndUpdate()` #9654
 * fix(index.d.ts): make methods and statics optional on schema #9801
 * fix(index.d.ts): remove non backwards compatible methods restriction #9801
 * docs: removed the extra word on comment doc #9794 [HenriqueLBorges](https://github.com/HenriqueLBorges)

5.11.11 / 2021-01-08
====================
 * fix(model): support calling `create()` with `undefined` as first argument and no callback #9765
 * fix(index.d.ts): ensure TypeScript knows that `this` refers to `DocType` in schema methods with strict mode #9755
 * fix(index.d.ts): make SchemaDefinition accept a model generic #9761 [mroohian](https://github.com/mroohian)
 * fix(index.d.ts): add `Aggregate#addFields()` #9774
 * fix(index.d.ts): allow setting `min` and `max` to [number, string] and [Date, string] #9762
 * fix(index.d.ts): improve context and type bindings for `Schema#methods` and `Schema#statics` #9717
 * docs: add recommended connection option #9768 [Fernando-Lozano](https://github.com/Fernando-Lozano)
 * chore: correct improper date in History.md #9783 [botv](https://github.com/botv)

5.11.10 / 2021-01-04
====================
 * fix(model): support `populate` option for `insertMany()` as a workaround for mongoose-autopopulate #9720
 * perf(schema): avoid creating extra array when initializing array of arrays #9588
 * perf(schema): avoid setting `arrayPath` when casting to a non-array, avoid unnecessarily setting atomics #9588
 * perf(schema): avoid expensive `String#slice()` call when creating a new array #9588
 * fix(queryhelpers): avoid modifying `lean.virtuals` in place #9754
 * fix: fall back to legacy treatment for square brackets if square brackets contents aren't a number #9640
 * fix(document): make fix for #9396 handle null values more gracefully #9709
 * fix(index.d.ts): add missing overloaded function for Document#populate() #9744 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): allow Model.create param1 overwrite #9753 [hasezoey](https://github.com/hasezoey)
 * fix(index.d.ts): improve autocomplete for query middleware #9752 [3Aahmednaser94](https://github.com/3Aahmednaser94)
 * fix(index.d.ts): add missing function for Aggregate#group() #9750 [coro101](https://github.com/coro101)
 * fix(index.d.ts): add missing `Aggregate#project()` #9763 [vorticalbox](https://github.com/vorticalbox)
 * fix(index.d.ts): allow `null` as an enum value for schematypes #9746
 * docs(guide+schema): make schema API docs and guide docs' list of Schema options line up #9749
 * docs(documents): add some more details about what the `save()` promise resolves to #9689
 * docs(subdocs): add section about subdocument defaults #7291
 * chore: run GitHub CI on PRs and update badge #9760 [YC](https://github.com/YC)

5.11.9 / 2020-12-28
===================
 * fix(document): keeps atomics when assigning array to filtered array #9651
 * fix(document): apply `defaults` option to subdocument arrays #9736
 * fix(index.d.ts): allow passing generic parameter to overwrite `lean()` result type #9728
 * fix(index.d.ts): add missing pre hook for findOneAndUpdate #9743 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): schema methods & statics types #9725
 * fix(index.d.ts): allow `id` paths with non-string values in TypeScript #9723
 * fix(index.d.ts): support calling `createIndexes()` and `ensureIndexes()` with just callback #9706
 * fix(index.d.ts): include `__v` in LeanDocuments #9687
 * fix(index.d.ts): add missing `Aggregate#append()` #9714
 * chore: add eslint typescript support and lint index.d.ts file #9729 [simllll](https://github.com/simllll)
 * chore: add Github Actions #9688 [YC](https://github.com/YC)

5.11.8 / 2020-12-14
===================
 * fix(index.d.ts): add missing single document populate #9696 [YC](https://github.com/YC)
 * fix(index.d.ts): make options optional for `toObject` #9700
 * fix(index.d.ts): added missing match and model methods in Aggregate class #9710 [manekshms](https://github.com/manekshms)
 * fix(index.d.ts): make options optional for `createIndexes()` and `ensureIndexes()` #9706
 * fix(index.d.ts): support passing a function to `ValidateOpts.message` #9697
 * docs: add media query for ::before on headings #9705 #9704 [YC](https://github.com/YC)

5.11.7 / 2020-12-10
===================
 * fix(document): ensure calling `get()` with empty string returns undefined for mongoose-plugin-autoinc #9681
 * fix(model): set `isNew` to false for documents that were successfully inserted by `insertMany` with `ordered = false` when an error occurred #9677
 * fix(index.d.ts): add missing Aggregate#skip() & Aggregate#limit() #9692 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): make `Document#id` optional so types that use `id` can use `Model<IMyType & Document>` #9684

5.11.6 / 2020-12-09
===================
 * fix(middleware): ensure sync errors in pre hooks always bubble up to the calling code #9659
 * fix(index.d.ts): allow passing ObjectId properties as strings to `create()` and `findOneAndReplace()` #9676
 * fix(index.d.ts): allow calling `mongoose.model()` and `Connection#model()` with model as generic param #9685 #9678 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): Fix return type of Model#aggregate() #9680 [orgads](https://github.com/orgads)
 * fix(index.d.ts): optional next() parameter for post middleware #9683 [isengartz](https://github.com/isengartz)
 * fix(index.d.ts): allow array of validators in SchemaTypeOptions #9686 [cjroebuck](https://github.com/cjroebuck)

5.11.5 / 2020-12-07
===================
 * fix(map): support `null` in maps of subdocs #9628
 * fix(index.d.ts): support object syntax for `validate` #9667
 * fix(index.d.ts): Allow number for Schema expires #9670 [alecgibson](https://github.com/alecgibson)
 * fix(index.d.ts): allow definining arbitrary properties on SchemaTypeOpts for plugins like mongoose-autopopulate #9669
 * fix(index.d.ts): add mongoose.models #9661 #9660 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(index.d.ts): allow the next() argument to be optional #9665 #9664 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): add missing `VirtualType#applyGetters()` and `applySetters()`, `Schema#virtuals`, `Schema#childSchemas`, `Query#_mongooseOptions` #9658
 * fix(index.d.ts): add `id` to LeanDocuments in case it is defined in the user's schema #9657
 * fix(index.d.ts): add missing types for hook functions #9653
 * fix(index.d.ts): improve support for strict null checks with `upsert` and `orFail()` #9654
 * fix(index.d.ts): make return values for `insertMany()` more consistent #9662
 * fix(index.d.ts): Change options in Connection#collection() to be optional #9663 [orgads](https://github.com/orgads)
 * fix(index.d.ts): add the missing generic declaration for Schema #9655 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): add missing `SchemaTypeOpts` and `ConnectionOptions` aliases for backwards compat
 * docs(populate): remove `sort()` from `limit` example to avoid potential confusion #9584
 * docs(compatibility): add MongoDB server 4.4 version compatibility #9641

5.11.4 / 2020-12-04
===================
 * fix(index.d.ts): add `Document#__v` so documents have a Version by default #9652 [sahasayan](https://github.com/sahasayan)
 * fix(index.d.ts): add missing `session` option to `SaveOptions` #9642
 * fix(index.d.ts): add `Schema#paths`, `Schema#static(obj)`, `Embedded#schema`, `DocumentArray#schema`, make Schema inherit from EventEmitter #9650
 * fix(index.d.ts): order when cb is optional in method #9647 [CatsMiaow](https://github.com/CatsMiaow)
 * fix(index.d.ts): use DocumentDefinition for `FilterQuery` #9649
 * fix(index.d.ts): correct callback result types for `find()`, `findOne()`, `findById()` #9648
 * fix(index.d.ts): remove `Document#parent()` method because it conflicts with existing user code #9645
 * fix(index.d.ts): add missing `Connection#db` property #9643
 * test(typescript): add `tsconfig.json` file for intellisense #9611 [alecgibson](https://github.com/alecgibson)

5.11.3 / 2020-12-03
===================
 * fix(index.d.ts): make Mongoose collection inherit MongoDB collection #9637 #9630 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(index.d.ts): add `Document#_id` so documents have an id by default #9632
 * fix(index.d.ts): allow inline schema definitions for nested properties #9639 [Green-Cat](https://github.com/Green-Cat)
 * fix(index.d.ts): add support for missing error message definitions #9638 [SaifAlsabe](https://github.com/SaifAlsabe)
 * fix(schema+discriminator): support defining recursive embedded discriminators by passing document array schematype to discriminator #9600
 * fix(index.d.ts): make it possible to use `LeanDocument` with arrays #9620
 * fix(index.d.ts): add `ModelUpdateOptions` as alias for `QueryOptions` for backwards compat #9637

5.11.2 / 2020-12-02
===================
 * fix(index.d.ts): add missing query options and model `findById()` function #9626 #9620
 * fix(index.d.ts): support defining schema paths as arrays of functions #9617
 * fix(index.d.ts): add automatic `_id` for Document, support creating Mongoose globals and accessing collection name #9618
 * fix(index.d.ts): add missing global `get()` and `set()` #9616
 * fix(index.d.ts): add missing `new` and `returnOriginal` options to QueryOptions, add missing model static properties #9627 #9616 #9615
 * fix(index.d.ts): allow `useCreateIndex` in connection options #9621

5.11.1 / 2020-12-01
===================
 * fix(index.d.ts): add missing SchemaOptions #9606
 * fix(index.d.ts): allow using `$set` in updates #9609
 * fix(index.d.ts): add support for using return value of `createConnection()` as a connection as well as a promise #9612 #9610 [alecgibson](https://github.com/alecgibson)
 * fix(index.d.ts): allow using `Types.ObjectId()` without `new` in TypeScript #9608

5.11.0 / 2020-11-30
===================
 * feat: add official TypeScript definitions `index.d.ts` file #8108
 * feat(connection): add bufferTimeoutMS option that configures how long Mongoose will allow commands to buffer #9469
 * feat(populate): support populate virtuals with `localField` and `foreignField` as arrays #6608
 * feat(populate+virtual): feat: support getters on populate virtuals, including `get` option for `Schema#virtual()` #9343
 * feat(populate+schema): add support for `populate` schematype option that sets default populate options #6029
 * feat(QueryCursor): execute post find hooks for each doc in query cursor #9345
 * feat(schema): support overwriting cast logic for individual schematype instances #8407
 * feat(QueryCursor): make cursor `populate()` in batch when using `batchSize` #9366 [biomorgoth](https://github.com/biomorgoth)
 * chore: remove changelog from published bundle #9404
 * feat(model+mongoose): add `overwriteModels` option to bypass `OverwriteModelError` globally #9406
 * feat(model+query): allow defining middleware for all query methods or all document methods, but not other middleware types #9190
 * feat(document+model): make change tracking skip saving if new value matches last saved value #9396
 * perf(utils): major speedup for `deepEqual()` on documents and arrays #9396
 * feat(schema): support passing a TypeScript enum to `enum` validator in schema #9547 #9546 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * feat(debug): #8963 `shell` option for date format (ISODate) #9532 [FlameFractal](https://github.com/FlameFractal)
 * feat(document): support square bracket indexing for `get()`, `set()` #9375
 * feat(document): support array and space-delimited syntax for `Document#$isValid()`, `isDirectSelected()`, `isSelected()`, `$isDefault()` #9474
 * feat(string): make `minLength` and `maxLength` behave the same as `minlength` and `maxlength` #8777 [m-weeks](https://github.com/m-weeks)
 * feat(document): add `$parent()` as an alias for `parent()` for documents and subdocuments to avoid path name conflicts #9455

5.10.19 / 2020-11-30
====================
 * fix(query): support passing an array to `$type` in query filters #9577
 * perf(schema): avoid creating unnecessary objects when casting to array #9588
 * docs: make example gender neutral #9601 [rehatkathuria](https://github.com/rehatkathuria)

5.10.18 / 2020-11-29
====================
 * fix(connection): connect and disconnect can be used destructured #9598 #9597 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)

5.10.17 / 2020-11-27
====================
 * fix(document): allow setting fields after an undefined field #9587 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)

5.10.16 / 2020-11-25
====================
 * fix(connection): copy config options from connection rather than base connection when calling `useDb()` #9569
 * fix(schema): support `of` for array type definitions to be consistent with maps #9564
 * docs(dates): fix broken example reference #9557 [kertof](https://github.com/kertof)
 * docs(virtualtype): remove unintentional h2 tag re: tj/dox#60 #9568

5.10.15 / 2020-11-16
====================
 * fix(array): make sure `Array#toObject()` returns a vanilla JavaScript array in Node.js 6+ #9540
 * fix(connection): make `disconnect()` stop Mongoose if it is trying to reconnect #9531
 * fix: ensure `Document#overwrite()` correctly overwrites maps #9549
 * fix(document): make transform work with nested paths #9544 #9543 [jonathan-wilkinson](https://github.com/jonathan-wilkinson)
 * fix(query): maxTimeMS in count, countDocuments, distinct #9552 [FlameFractal](https://github.com/FlameFractal)
 * fix(schema): remove warning re: `increment` as a schema path name #9538
 * fix(model): automatically set `partialFilterExpression` for indexes in discriminator schemas #9542

5.10.14 / 2020-11-12
====================
 * fix(update): handle casting immutable object properties with `$setOnInsert` #9537
 * fix(discriminator): overwrite instead of merge if discriminator schema specifies a path is single nested but base schema has path as doc array #9534
 * docs(middleware): clarify that you need to set both `document` and `query` on `remove` hooks to get just document middleware #9530 [mustafaKamal-fe](https://github.com/mustafaKamal-fe)
 * docs(CONTRIBUTING): remove mmapv1 recommendation and clean up a few other details #9529
 * refactor: remove duplicate function definition #9527 [ksullivan](https://github.com/ksullivan)

5.10.13 / 2020-11-06
====================
 * fix: upgrade mongodb driver -> 3.6.3 for Lambda cold start fixes #9521 #9179 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(document): correctly handle setting props to other nested props #9519

5.10.12 / 2020-11-04
====================
 * fix(connection): catch and report sync errors in connection wrappers like `startSession()` #9515
 * fix(document): ignore getters when diffing values for change tracking #9501
 * fix(connection): avoid executing promise handler unless it's a function #9507 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(error): throw more helpful error when connecting to a non-SSL MongoDB server with SSL enabled #9511
 * docs(model+query): clarify that `deleteOne` and `deleteMany` trigger middleware #9504
 * docs(ssl): add note about `ssl` defaulting to `true` for srv connection strings #9511

5.10.11 / 2020-10-26
====================
 * fix(connection): when calling `mongoose.connect()` multiple times in parallel, make 2nd call wait for connection before resolving #9476
 * fix(map): make `save()` persist `Map#clear()` #9493
 * fix(document): avoid overwriting array subdocument when setting dotted path that isn't selected #9427
 * fix(connection): don't throw Atlas error if server discovery doesn't find any servers #9470
 * docs: update options for Model.findOneAndUpdate #9499 [radamson](https://github.com/radamson)

5.10.10 / 2020-10-23
====================
 * fix(schema): handle merging schemas from separate Mongoose module instances when schema has a virtual #9471
 * fix(connection): make connection.then(...) resolve to a connection instance #9497 [AbdelrahmanHafez](https://github.com/AbdelrahmanHafez)
 * fix(aggregate): when using $search with discriminators, add `$match` as the 2nd stage in 